<style>
    .hidden-form{
        display: None;
    }
</style>

<form method="POST" class="php-email-form p-3 p-md-4" enctype="multipart/form-data">
    {% csrf_token %}
    <div class="row mb-2">
        {% for field in formulario %}
            <div class="form-group">
                {{ field.label }}:
                {{ field }}            
            </div>
            <div class="error">
                {{ field.errors }}
            </div>
        {% endfor %}
        <div class="form-group">
            Ingredientes:
            <hr>
        </div>
        {% if formset %}
            {{ formset.management_form }}
            <div id="ingredient-form-list">
                {% for form in formset %}
                    <div class="ingredient-form">
                        {{ form }}
                        <hr>
                    </div>
                {% endfor %}
            </div>
            <div class="hidden-form" id="empty-form">
                {{ formset.empty_form }}
                <hr>
            </div>
            <div class="d-flex flex-row-reverse">
                <button type="button" class="btn btn-light" id="add-more"><i class="bi bi-plus-circle"></i></button>
                <button type="button" class="btn btn-light" id="remove-one"><i class="bi bi-trash"></i></button>
            </div>
        {% endif %}
    </div>
    <hr>
    <input type="submit" value="Guardar" class="btn btn-success">
    <a href="{% url 'rct:mis_recetas' %}"><input class="btn btn-warning" type="button" value="Cancelar"></a>
</form>

<script>
    {% comment %} const addMoreBtn = document.getElementById('add-more')
    addMoreBtn.addEventListener('click', add_new_form)
    function add_new_form(event){
        if (event){
            event.preventDefault()
        }        
        const formCopyTarget=document.getElementById('ingredient-form-list')
        const emptyFormEl = document.getElementById('empty-form').cloneNode(true)
        emptyFormEl.setAttribute('class', 'ingredient-form')
        formCopyTarget.append(emptyFormEl)
    } {% endcomment %}
    document.addEventListener('click', (event)=>{
        if (event.target.id == 'add-more') {
            add_new_form(event)
        }
    })
    function add_new_form(event){
        if (event){
            event.preventDefault()
        }
        const totalNewForms = document.getElementById('id_form-TOTAL_FORMS')
        const currentIngredientForms = document.getElementsByClassName('ingredient-form')
        const currentFormCount = currentIngredientForms.length
        const valueCount = currentFormCount + 1
        const formCopyTarget = document.getElementById('ingredient-form-list')
        const copyEmptyFormEl = document.getElementById('empty-form').cloneNode(true)
        copyEmptyFormEl.setAttribute('class','ingredient-form')
        copyEmptyFormEl.setAttribute('id', `form-${currentFormCount}`)
        const regex = new RegExp('__prefix__','g')
        copyEmptyFormEl.innerHTML = copyEmptyFormEl.innerHTML.replace(regex,currentFormCount)
        totalNewForms.setAttribute('value',valueCount)
        formCopyTarget.append(copyEmptyFormEl) 
    }
</script>