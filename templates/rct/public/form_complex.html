<style>
    .hidden-form{
        display: None;
    }
</style>

<div class="row mb-2">

        <div class="form-group">
            {{ form1.nombre_receta.label }}
            {{ form1.nombre_receta }}            
        </div>
        <div class="form-group">
            {{ form1.imagen_receta.label }}
            {{ form1.imagen_receta }}            
        </div>
        <div class="form-group ">
            {{ form1.tiempo_prep_receta.label }}
            {{ form1.tiempo_prep_receta }}
        </div>
        <div class="form-group ">
            {{ form1.porciones_receta.label }}
            {{ form1.porciones_receta }}           
        </div>
        <div class="form-group ">
            <label>Ingredientes:</label>
            <hr>
            <div id="ingredient-form-list">
                {{ formset.management_form }}
                <div class="">
                    {{ formset }}
                </div>
            </div>
            <div id="ingredient-form-list">
                <div class="hidden-form" id="empty-form">                    
                    {{ formset.empty_form }}
                    <hr>    
                </div>
            </div>
            <div class="col mt-2">
                <div class="d-flex flex-row-reverse">
                    <div class='col-xs-6'>
                        <button type="button" class="btn btn-light" id='delete-last'><i class="bi bi-trash3" style="font-size:1rem"></i></button>                            
                    </div>
                    <div class='col-xs-6'>
                        <button type="button" class="btn btn-light" id='add-more'><i class="bi bi-plus-circle" style="font-size:1rem"></i></button>                            
                    </div>
                </div>
            </div>
            <hr>
        </div>
        <div class="form-group ">
            {{ form1.pasos_receta.label }}
            {{ form1.pasos_receta }}           
        </div>
        <div class="error">
            {{ field.errors }}
        </div>
    
</div>
{% for message in messages %}
    <div class="alert alert-danger text-center" role="alert">{{ message }}</div>
{% endfor %}
<input type="submit" value="Guardar" class="btn btn-success">
<a href="{% url 'rct:mis_recetas' %}"><input class="btn btn-warning" type="button" value="Cancelar"></a>

<script>
    const totalNewForms = document.getElementById('id_form-TOTAL_FORMS')
    document.addEventListener('click', (event)=>{
        if (event.target.id == 'add-more') {
            add_new_form(event)
        }
    })
    function add_new_form(event){
        if (event){
            event.preventDefault()
        }
        const currentIngredientForms = document.getElementsByClassName('ingredient-form')
        const currentFormCount = currentIngredientForms.length
        const formCopyTarget = document.getElementById('ingredient-form-list')
        const copyEmptyFormEl = document.getElementById('empty-form').cloneNode(true)
        copyEmptyFormEl.setAttribute('class','ingredient-form')
        copyEmptyFormEl.setAttribute('id', `form-${currentFormCount}`)
        const regex = new RegExp('__prefix__','g')
        copyEmptyFormEl.innerHTML = copyEmptyFormEl.innerHTML.replace(regex,currentFormCount)
        totalNewForms.setAttribute('value',currentFormCount+1)
        formCopyTarget.append(copyEmptyFormEl)
    }
</script>